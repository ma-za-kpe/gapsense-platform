# GapSense MVP Flow Diagram (ASCII)

================================================================================
                          GAPSENSE MVP USER FLOWS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ENTRY POINTS                                       â”‚
â”‚                                                                              â”‚
â”‚  1. School Registration (Web/API)  â†’  Generate Invitation Code              â”‚
â”‚  2. Teacher WhatsApp Message       â†’  FLOW-TEACHER-ONBOARD                  â”‚
â”‚  3. Parent WhatsApp Message        â†’  FLOW-ONBOARD                           â”‚
â”‚  4. Parent Opt-Out Keyword         â†’  FLOW-OPT-OUT (instant)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
FLOW 1: SCHOOL REGISTRATION (API/Web Interface)
================================================================================

  Headmaster/Admin
         â”‚
         â”œâ”€â†’ GET /api/v1/schools/search?q=<name>
         â”‚   (Search GES school database for autocomplete)
         â”‚
         â””â”€â†’ POST /api/v1/schools/register
             {
               school_name: "St. Mary's JHS",
               ges_school_id: 12345,
               headmaster_name: "Mr. Mensah",
               phone: "+233244123456",
               num_teachers: 10
             }
             â†“
         âœ… School Created
         âœ… Invitation Code Generated: "STMARYS-ABC123"
         â†“
    (Share code with teachers)


================================================================================
FLOW 2: TEACHER ONBOARDING (WhatsApp)
================================================================================

  Teacher sends message to WhatsApp number
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 1: COLLECT_INVITATION_CODE     â”‚
  â”‚  "Enter your school invitation code" â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Teacher: "STMARYS-ABC123"
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  VALIDATE CODE                        â”‚
  â”‚  âœ“ Code exists?                       â”‚
  â”‚  âœ“ is_active = true?                  â”‚
  â”‚  âœ“ teachers_joined < max_teachers?    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ âœ… Valid
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 2: COLLECT_NAME                â”‚
  â”‚  "What's your full name?"             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Teacher: "Ms. Adwoa Mensah"
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 3: COLLECT_GRADE               â”‚
  â”‚  "What grade do you teach?"           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Teacher: "JHS 1"
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 4: UPLOAD_ROSTER                â”‚
  â”‚  "Upload student names (CSV/photo)"   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Teacher: [Uploads CSV]
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  PROCESS_ROSTER                       â”‚
  â”‚  â€¢ Parse CSV                          â”‚
  â”‚  â€¢ Create Student records             â”‚
  â”‚  â€¢ Link students to teacher           â”‚
  â”‚  â€¢ primary_parent_id = NULL (unlinked)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  âœ… Teacher Onboarded
  âœ… 25 Students Created (Unlinked)
  âœ… Ready for parent onboarding


================================================================================
FLOW 3: PARENT ONBOARDING (WhatsApp - Teacher-Initiated)
================================================================================

  Parent sends "Hi" to WhatsApp
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 1: AWAITING_OPT_IN             â”‚
  â”‚  Welcome message with button          â”‚
  â”‚  [Yes, let's start!] [Not now]        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parent: [Clicks "Yes"]
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 2: AWAITING_STUDENT_SELECTION  â”‚
  â”‚  Show list of unlinked students:      â”‚
  â”‚  1. Kwame Mensah (JHS 1, St. Mary's) â”‚
  â”‚  2. Ama Osei (JHS 1, St. Mary's)     â”‚
  â”‚  3. ...                               â”‚
  â”‚  "Reply with the number"              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parent: "1"
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 3: CONFIRM_STUDENT_SELECTION   â”‚
  â”‚  "You selected: Kwame Mensah"         â”‚
  â”‚  "Grade: JHS 1"                       â”‚
  â”‚  "Is this your child?"                â”‚
  â”‚  [Yes, correct] [No, go back]         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parent: [Clicks "Yes"]
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 4: AWAITING_DIAGNOSTIC_CONSENT â”‚
  â”‚  "To help Kwame learn, we'll send a  â”‚
  â”‚   quick diagnostic quiz..."           â”‚
  â”‚  "Do you consent?"                    â”‚
  â”‚  [Yes, proceed] [No, skip for now]    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parent: [Clicks "Yes, proceed"]
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STEP 5: AWAITING_LANGUAGE           â”‚
  â”‚  "What language would you like?"      â”‚
  â”‚  [English] [Twi] [Ga]                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Parent: [Clicks "Twi"]
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  COMPLETE ONBOARDING                  â”‚
  â”‚  â€¢ student.primary_parent_id = parent â”‚
  â”‚  â€¢ student.home_language = "tw"       â”‚
  â”‚  â€¢ parent.onboarded_at = NOW          â”‚
  â”‚  â€¢ parent.preferred_language = "tw"   â”‚
  â”‚  â€¢ conversation_state = NULL          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  AUTO-TRIGGER DIAGNOSTIC              â”‚
  â”‚  IF parent.diagnostic_consent = True  â”‚
  â”‚  THEN create DiagnosticSession        â”‚
  â”‚       status = "pending"              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  âœ… Parent Linked to Student
  âœ… Diagnostic Session Pending


================================================================================
FLOW 4: ADAPTIVE DIAGNOSTIC (WhatsApp - Auto-Triggered)
================================================================================

  Parent sends any message (24hr window open)
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  DETECT PENDING SESSION               â”‚
  â”‚  SELECT * FROM diagnostic_sessions    â”‚
  â”‚  WHERE student.primary_parent_id = p  â”‚
  â”‚    AND status = 'pending'             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ âœ… Found pending session
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  START SESSION                        â”‚
  â”‚  â€¢ status = "in_progress"             â”‚
  â”‚  â€¢ started_at = NOW                   â”‚
  â”‚  â€¢ conversation_state["flow"] = "..." â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                   ADAPTIVE QUESTION LOOP                        â”‚
  â”‚                                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ PHASE 1: SCREENING (Questions 1-12)                     â”‚   â”‚
  â”‚  â”‚ Test 6 priority nodes Ã— 2 questions each                â”‚   â”‚
  â”‚  â”‚ â€¢ B2.1.1.1: Place value to 1000                         â”‚   â”‚
  â”‚  â”‚ â€¢ B1.1.2.2: Subtraction within 100                      â”‚   â”‚
  â”‚  â”‚ â€¢ B2.1.2.2: Multiplication concept                      â”‚   â”‚
  â”‚  â”‚ â€¢ B2.1.3.1: Fraction concept                            â”‚   â”‚
  â”‚  â”‚ â€¢ B3.1.3.1: Fraction equivalence                        â”‚   â”‚
  â”‚  â”‚ â€¢ B4.1.3.1: Fraction operations                         â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â†“                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ GET_NEXT_NODE (AdaptiveDiagnosticEngine)                â”‚   â”‚
  â”‚  â”‚ â€¢ IF screening not complete â†’ Next screening node       â”‚   â”‚
  â”‚  â”‚ â€¢ IF gap detected â†’ Trace prerequisites backward        â”‚   â”‚
  â”‚  â”‚ â€¢ IF deep tracing done â†’ Cross-check different cascade  â”‚   â”‚
  â”‚  â”‚ â€¢ IF max questions (15) â†’ STOP                          â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â†“                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ GENERATE_QUESTION (QuestionGenerator)                   â”‚   â”‚
  â”‚  â”‚ â€¢ Try AI (Grok via DIAG-001 prompt)                     â”‚   â”‚
  â”‚  â”‚ â€¢ Fallback to templates if AI fails                     â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â†“                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ SEND_QUESTION (WhatsApp)                                â”‚   â”‚
  â”‚  â”‚ "Question 3 for Kwame:"                                 â”‚   â”‚
  â”‚  â”‚ "What is 47 - 23?"                                      â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â†“                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ AWAITING_ANSWER                                          â”‚   â”‚
  â”‚  â”‚ conversation_state["step"] = "AWAITING_ANSWER"          â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â”‚ Parent: "24"                                         â”‚
  â”‚          â†“                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ ANALYZE_ANSWER                                           â”‚   â”‚
  â”‚  â”‚ â€¢ Check correctness (string match)                      â”‚   â”‚
  â”‚  â”‚ â€¢ Mark node as tested                                   â”‚   â”‚
  â”‚  â”‚ â€¢ Update session.nodes_tested[]                         â”‚   â”‚
  â”‚  â”‚ â€¢ Update session.nodes_mastered[] OR nodes_gap[]        â”‚   â”‚
  â”‚  â”‚ â€¢ session.total_questions += 1                          â”‚   â”‚
  â”‚  â”‚ â€¢ session.correct_answers += 1 (if correct)             â”‚   â”‚
  â”‚  â”‚ â€¢ Save to database                                      â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚          â”‚                                                      â”‚
  â”‚          â†“                                                      â”‚
  â”‚  IF more nodes to test â†’ LOOP BACK TO GET_NEXT_NODE â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  IF no more nodes OR max questions â†’ EXIT LOOP                 â”‚
  â”‚                                                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  COMPLETE SESSION                     â”‚
  â”‚  â€¢ status = "completed"               â”‚
  â”‚  â€¢ completed_at = NOW                 â”‚
  â”‚  â€¢ conversation_state = NULL          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  GENERATE GAP PROFILE                 â”‚
  â”‚  (GapProfileAnalyzer)                 â”‚
  â”‚  â€¢ Identify primary gap (deepest)     â”‚
  â”‚  â€¢ Estimate grade level               â”‚
  â”‚  â€¢ Calculate grade gap                â”‚
  â”‚  â€¢ Identify cascade path              â”‚
  â”‚  â€¢ AI root cause analysis (DIAG-003)  â”‚
  â”‚  â€¢ Save gap_profile to DB âœ…          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  SEND COMPLETION MESSAGE              â”‚
  â”‚  "Diagnostic complete for Kwame! ğŸ‰"  â”‚
  â”‚  "Questions: 15"                      â”‚
  â”‚  "Correct: 8 (53%)"                   â”‚
  â”‚  "We've identified where Kwame needs  â”‚
  â”‚   support. Lessons coming soon!"      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  âœ… Diagnostic Complete
  âœ… Gap Profile Saved
  âš ï¸  Next: Content Delivery (NOT IMPLEMENTED)


================================================================================
FLOW 5: OPT-OUT (Instant - Any Time)
================================================================================

  Parent sends opt-out keyword
  (STOP, gyae, tÉ”tÉ”, tsia, nyÉ›li)
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  INSTANT OPT-OUT                      â”‚
  â”‚  â€¢ parent.opted_out = TRUE            â”‚
  â”‚  â€¢ parent.opted_out_at = NOW          â”‚
  â”‚  â€¢ conversation_state = NULL          â”‚
  â”‚  â€¢ Clear all active flows             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  SEND CONFIRMATION                    â”‚
  â”‚  "We've stopped all messages."        â”‚
  â”‚  "Your data will be removed."         â”‚
  â”‚  "To restart, send 'Hi'. Thank you ğŸ™"â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  âœ… Opted Out (Wolf/Aurino Compliant)


================================================================================
PLANNED FLOWS (NOT YET IMPLEMENTED)
================================================================================

  FLOW-ACTIVITY (Content Delivery) âŒ 0%
         â”‚
         â”œâ”€â†’ Send daily 3-minute activities
         â”œâ”€â†’ Collect completion confirmations
         â”œâ”€â†’ Track progress
         â””â”€â†’ Adapt difficulty based on progress

  FLOW-CHECK-IN (Progress Monitoring) âŒ 0%
         â”‚
         â”œâ”€â†’ Weekly check-in questions
         â”œâ”€â†’ AI sentiment analysis
         â”œâ”€â†’ Adjust activities if needed
         â””â”€â†’ Send encouragement

  FLOW-RE-DIAGNOSTIC (Follow-up) âŒ 0%
         â”‚
         â”œâ”€â†’ Re-assess after 4-6 weeks
         â”œâ”€â†’ Compare to previous gap profile
         â”œâ”€â†’ Measure improvement velocity
         â””â”€â†’ Update gap profile


================================================================================
ERROR RECOVERY & COMMANDS
================================================================================

  At ANY point, parent can send:

  /restart   â†’ Clear conversation_state, start fresh
  /cancel    â†’ Cancel current flow, go to main menu
  /help      â†’ Show available commands
  /status    â†’ Show current flow and step

  Session Expiry:
  IF last_message_at > 24 hours:
     â†’ Clear conversation_state automatically
     â†’ Next message starts new flow


================================================================================
CRITICAL PATH FOR MVP LAUNCH
================================================================================

  âœ… 1. School Registration (Web/API)
  âœ… 2. Teacher Onboarding (WhatsApp)
  âœ… 3. Teacher Roster Upload
  âœ… 4. Parent Onboarding (WhatsApp)
  âœ… 5. Diagnostic Auto-Trigger
  âœ… 6. Adaptive Assessment (15 questions)
  âœ… 7. Gap Profile Generation

  âŒ 8. Activity Delivery (BLOCKING LAUNCH)
  âŒ 9. Progress Tracking (BLOCKING LAUNCH)

  Current Completion: 70%
  MVP Launch Blocked: Need Steps 8-9


================================================================================
API ENDPOINTS SUMMARY
================================================================================

  Schools:
    GET  /api/v1/schools/search?q={query}
    POST /api/v1/schools/register

  Teachers:
    POST /api/v1/teachers/
    GET  /api/v1/teachers/{id}
    GET  /api/v1/teachers/{id}/students

  Parents:
    POST /api/v1/parents/
    GET  /api/v1/parents/{id}
    GET  /api/v1/parents/{id}/students

  Diagnostics:
    POST /api/v1/diagnostics/sessions
    GET  /api/v1/diagnostics/sessions/{id}
    GET  /api/v1/diagnostics/gap-profiles/{student_id}

  Curriculum:
    GET  /api/v1/curriculum/strands
    GET  /api/v1/curriculum/nodes
    GET  /api/v1/curriculum/nodes/{code}/prerequisites

  Webhook:
    GET  /api/v1/webhook/whatsapp (verification)
    POST /api/v1/webhook/whatsapp (incoming messages)


================================================================================
